# 技術設計: ライブラリ名変更（shishin → shishin）

## 1. 概要
本設計書は、Pythonライブラリ「shishin」を「shishin」にリネームするための技術的アプローチを定義します。

## 2. 変更戦略

### 2.1 変更順序
以下の順序で変更を実施し、各ステップで整合性を保ちます：

1. **ディレクトリ名の変更**
   - `/shishin/` → `/shishin/`
   - gitでの追跡を維持するため、`git mv`コマンドを使用

2. **プロジェクト設定の更新**
   - `pyproject.toml`のパッケージ名を更新

3. **Pythonファイル内の参照更新**
   - docstring内の「shishin」→「shishin」
   - モジュール内のコメント更新

4. **インポート文の更新**
   - テストファイル内の全インポート文
   - `from shishin.` → `from shishin.`
   - モックパスの更新（`@patch`デコレータ）

5. **Jupyterノートブックの更新**
   - インポート文の変更
   - コメントの更新
   - カーネル名の更新
   - 出力パスの更新

6. **ドキュメントの更新**
   - README.md
   - .tmp内の既存ドキュメント

## 3. 技術的詳細

### 3.1 ディレクトリ構造
```
現在:
shishin/
├── shishin/
│   ├── __init__.py
│   ├── types.py
│   ├── converters/
│   ├── interactions/
│   └── readers/

変更後:
shishin/
├── shishin/
│   ├── __init__.py
│   ├── types.py
│   ├── converters/
│   ├── interactions/
│   └── readers/
```

### 3.2 正規表現パターン
変更に使用する主な正規表現パターン：
- インポート文: `from shishin\.` → `from shishin.`
- パッチ: `@patch\('shishin\.` → `@patch('shishin.`
- 大文字: `Shishin` → `Shishin`
- 小文字: `shishin` → `shishin`

### 3.3 ファイルタイプ別の処理

#### Python Files (.py)
- 文字列置換: シンプルな文字列置換
- インポート文: 正規表現による置換
- コメント: 大文字小文字を考慮した置換

#### Jupyter Notebooks (.ipynb)
- JSONフォーマットのため、慎重な処理が必要
- セルの内容を個別に処理
- メタデータ（カーネル名）も更新

#### Configuration Files
- `pyproject.toml`: TOML形式での編集
- 単純な文字列置換で対応可能

## 4. リスク管理

### 4.1 潜在的リスク
1. **インポートエラー**: 不完全な置換によるインポートエラー
2. **テストの失敗**: パッチパスの不整合
3. **ノートブックの破損**: JSON構造の破壊

### 4.2 リスク軽減策
1. **段階的実行**: 各ステップ後の動作確認
2. **バックアップ**: 変更前の状態を保持（git管理）
3. **検証**: 各変更後のテスト実行

## 5. 検証計画

### 5.1 単体検証
- 各ファイルの変更後、構文エラーがないことを確認
- インポート文が正しく解決されることを確認

### 5.2 統合検証
- 全テストスイートの実行
- ノートブックの実行確認
- パッケージのインストール確認

## 6. ロールバック計画
変更に問題が発生した場合：
1. `git reset --hard`で変更前の状態に戻す
2. 問題の原因を特定
3. 修正後、再実行

## 7. 実装の詳細

### 7.1 使用するツール
- `git mv`: ディレクトリ名の変更
- `sed`/Python: 文字列置換
- `pytest`: テストの実行
- `ruff`/`black`: コードフォーマットの確認

### 7.2 自動化
可能な限り自動化し、手動作業を最小限に抑える：
- バッチ処理による一括置換
- スクリプトによる検証の自動化